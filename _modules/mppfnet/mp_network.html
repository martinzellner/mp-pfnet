<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mppfnet.mp_network &mdash; MP-PFNET 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MP-PFNET 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mppfnet.mp_network</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">pfnet</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c1">#from . import load_profile</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">solar_profile</span>


<div class="viewcode-block" id="MPNetwork"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork">[docs]</a><span class="k">class</span> <span class="nc">MPNetwork</span><span class="p">():</span>
    <span class="n">networks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">timesteps</span> <span class="o">=</span> <span class="mi">8760</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1.1.2016&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y&quot;</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1.1.2017&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y&quot;</span><span class="p">)</span>
    <span class="n">load_profile_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">solar_profile_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">e_init</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (in MWh)</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># (in hours)</span>
    <span class="n">energy_price</span> <span class="o">=</span> <span class="mf">35.0</span>  <span class="c1"># (in â‚¬/Mwh)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="mi">8760</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instanciates a new multi-period pfnet network.</span>

<span class="sd">        :param timesteps: The number of timesteps the network is created for</span>
<span class="sd">        :type timesteps: :class:`int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">timesteps</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Multi-Period Network with {0} timesteps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>

<div class="viewcode-block" id="MPNetwork.add_vargens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.add_vargens">[docs]</a>    <span class="k">def</span> <span class="nf">add_vargens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buses</span><span class="p">,</span> <span class="n">penetration</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">corr_radius</span><span class="p">,</span> <span class="n">corr_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a variable generator (PV, Wind, etc.) to the network`</span>

<span class="sd">        :param buses: The buses the generators should be added to</span>
<span class="sd">        :param penetration:</span>
<span class="sd">        :param uncertainty:</span>
<span class="sd">        :param corr_radius:</span>
<span class="sd">        :param corr_value:</span>

<span class="sd">        :seealso: :meth:`pfnet.Network.add_vargens()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">add_vargens</span><span class="p">(</span><span class="n">buses</span><span class="p">,</span> <span class="n">penetration</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">corr_radius</span><span class="p">,</span> <span class="n">corr_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.adjust_generators"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.adjust_generators">[docs]</a>    <span class="k">def</span> <span class="nf">adjust_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :seealso: :meth:`pfnet.Network.adjust_generators()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">adjust_generators</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.clear_error"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.clear_error">[docs]</a>    <span class="k">def</span> <span class="nf">clear_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :seealso: :meth:`pfnet.Network.clear_error`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">clear_error</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.clear_properties"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.clear_properties">[docs]</a>    <span class="k">def</span> <span class="nf">clear_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :seealso: :meth:`pfnet.Network.clear_properties`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">clear_properties</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.clear_sensitivities"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.clear_sensitivities">[docs]</a>    <span class="k">def</span> <span class="nf">clear_sensitivities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">clear_sensitivities</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.create_sorted_bus_list"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.create_sorted_bus_list">[docs]</a>    <span class="k">def</span> <span class="nf">create_sorted_bus_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort_by</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">create_sorted_bus_list</span><span class="p">(</span><span class="n">sort_by</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.create_vargen_P_sigma"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.create_vargen_P_sigma">[docs]</a>    <span class="k">def</span> <span class="nf">create_vargen_P_sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spread</span><span class="p">,</span> <span class="n">corr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">create_vargen_P_sigma</span><span class="p">(</span><span class="n">spread</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_branch"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_branch">[docs]</a>    <span class="k">def</span> <span class="nf">get_branch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_branch</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_bus"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_bus">[docs]</a>    <span class="k">def</span> <span class="nf">get_bus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a specific bus for a given time</span>

<span class="sd">        :param index: the bus index</span>
<span class="sd">        :type index: :class:`int</span>
<span class="sd">        :param time: the time to get the bus for (defaults to 0)`</span>
<span class="sd">        :type time: :class:`int</span>
<span class="sd">        :return: The requested bus</span>
<span class="sd">        :rtype: :class:`pfnet.Bus`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_bus</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_bus_by_name"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_bus_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_bus_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a specific bus for a given time</span>

<span class="sd">        :param index: the bus name</span>
<span class="sd">        :param time: the time to get the bus for (defaults to 0)</span>
<span class="sd">        :return: a pfnet bus object</span>
<span class="sd">        :rtype: :class:`pfnet.Bus`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_bus_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_bus_by_number"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_bus_by_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_bus_by_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a specific bus for a given time</span>

<span class="sd">        :param index: the bus number</span>
<span class="sd">        :param time: the time to get the bus for (defaults to 0)</span>
<span class="sd">        :return: a pfnet bus object</span>
<span class="sd">        :rtype: :class:`pfnet.Bus`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_bus_by_number</span><span class="p">(</span><span class="n">number</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_gen"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_gen">[docs]</a>    <span class="k">def</span> <span class="nf">get_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a specific generator for a given time</span>

<span class="sd">        :param index: the generator index</span>
<span class="sd">        :param time: the time to get the generator for (defaults to 0)</span>
<span class="sd">        :return: a pfnet generator object</span>
<span class="sd">        :rtype: :class:`pfnet.Generator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_gen</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_gen_buses"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_gen_buses">[docs]</a>    <span class="k">def</span> <span class="nf">get_gen_buses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_gen_buses</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_load"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_load">[docs]</a>    <span class="k">def</span> <span class="nf">get_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a specific load for a given time</span>

<span class="sd">        :param index: the load index</span>
<span class="sd">        :param time: the time to get the load for (defaults to 0)</span>
<span class="sd">        :return: a pfnet load object</span>
<span class="sd">        :rtype: :class:`pfnet.Load`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_load</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_load_buses"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_load_buses">[docs]</a>    <span class="k">def</span> <span class="nf">get_load_buses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_load_buses</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_P_adjust_gens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_P_adjust_gens">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_P_adjust_gens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_P_adjust_gens</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_P_adjust_loads"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_P_adjust_loads">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_P_adjust_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_P_adjust_loads</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_branches"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_branches">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_branches</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_branches_not_on_outage"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_branches_not_on_outage">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_branches_not_on_outage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_branches_not_on_outage</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_buses"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_buses">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_buses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_buses</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_buses_reg_by_gen"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_buses_reg_by_gen">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_buses_reg_by_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_buses_reg_by_gen</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_buses_reg_by_shunt"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_buses_reg_by_shunt">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_buses_reg_by_shunt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_buses_reg_by_shunt</span><span class="p">(</span><span class="n">only</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_buses_reg_by_tran"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_buses_reg_by_tran">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_buses_reg_by_tran</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_buses_reg_by_tran</span><span class="p">(</span><span class="n">only</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_fixed_shunts"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_fixed_shunts">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_fixed_shunts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_fixed_shunts</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_fixed_trans"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_fixed_trans">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_fixed_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_fixed_trans</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_gens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_gens">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_gens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_gens</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_gens_not_on_outage"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_gens_not_on_outage">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_gens_not_on_outage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_gens_not_on_outage</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_lines"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_lines">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_lines</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_loads"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_loads">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_loads</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_phase_shifters"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_phase_shifters">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_phase_shifters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_phase_shifters</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_reg_gens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_reg_gens">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_reg_gens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_reg_gens</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_shunts"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_shunts">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_shunts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_shunts</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_slack_buses"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_slack_buses">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_slack_buses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_slack_buses</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_slack_gens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_slack_gens">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_slack_gens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_slack_gens</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_switched_shunts"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_switched_shunts">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_switched_shunts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_switched_shunts</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_tap_changers"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_tap_changers">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_tap_changers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_tap_changers</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_tap_changers_Q"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_tap_changers_Q">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_tap_changers_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_tap_changers_Q</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_tap_changers_v"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_tap_changers_v">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_tap_changers_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_tap_changers_v</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_num_vargens"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_num_vargens">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_vargens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_vargens</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_properties"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_properties">[docs]</a>    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_properties</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.get_shunt"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_shunt">[docs]</a>    <span class="k">def</span> <span class="nf">get_shunt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_shunt</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_var_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_var_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_var_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_var_projection</span><span class="p">(</span><span class="n">obj_type</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_var_values"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_var_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_var_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">pfnet</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_var_values</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_vargen"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_vargen">[docs]</a>    <span class="k">def</span> <span class="nf">get_vargen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_vargen</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_vargen_by_name"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_vargen_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_vargen_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">get_vargen_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.has_error"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.has_error">[docs]</a>    <span class="k">def</span> <span class="nf">has_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">network</span><span class="o">.</span><span class="n">has_error</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="MPNetwork.load"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>

        <span class="c1"># set base power and num_vars so mppfnet behaves like pfnet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">base_power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">num_vars</span></div>

<div class="viewcode-block" id="MPNetwork.set_flags"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.set_flags">[docs]</a>    <span class="k">def</span> <span class="nf">set_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets flags of networks components with specific properties.</span>

<span class="sd">        :param obj_type: Component Types</span>
<span class="sd">        :param flags: Flag Marks</span>
<span class="sd">        :param props:</span>
<span class="sd">        :param vals:</span>

<span class="sd">        :seealso: :meth:`pfnet.Network.set_flags`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">obj_type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>

        <span class="c1"># Update number of variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">num_vars</span></div>

<div class="viewcode-block" id="MPNetwork.set_flags_of_component"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.set_flags_of_component">[docs]</a>    <span class="k">def</span> <span class="nf">set_flags_of_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets flags of networks components with specific properties.</span>

<span class="sd">        :param obj:</span>
<span class="sd">        :param flags:</span>
<span class="sd">        :param vals:</span>

<span class="sd">        :seealso: :meth:`pfnet.Network.set_flags_of_component`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_flags_of_component</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.set_var_values"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.set_var_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_var_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_var_values</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">nx</span><span class="p">:</span><span class="n">i</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">+</span> <span class="n">nx</span><span class="p">])</span></div>

<div class="viewcode-block" id="MPNetwork.show_buses"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.show_buses">[docs]</a>    <span class="k">def</span> <span class="nf">show_buses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">sort_by</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">show_buses</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">sort_by</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.show_components"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.show_components">[docs]</a>    <span class="k">def</span> <span class="nf">show_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the components of the networks.</span>

<span class="sd">        :seealso: :meth:`pfnet.Network.show_components`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Network Components&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;timesteps:           : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;------- per timestep --------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;buses:               : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_buses</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   slack:            : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_slack_buses</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   reg by gen:       : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_buses_reg_by_gen</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   reg by tran:      : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_buses_reg_by_tran</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   reg by shunt:     : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_buses_reg_by_shunt</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;shunts:              : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_shunts</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   fixed:            : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_fixed_shunts</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   switched v:       : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_switched_shunts</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;branches:            : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_branches</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   lines:            : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_lines</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   fixed trans:      : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_fixed_trans</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   phase shifters    : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_phase_shifters</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   tap changers v    : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_tap_changers_v</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   tap changers Q    : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_tap_changers_Q</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;generators:          : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_gens</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   slack:            : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_slack_gens</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   reg:              : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_reg_gens</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   P adjust          : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_P_adjust_gens</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;loads:               : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_loads</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;   P adjust:         : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_P_adjust_loads</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;vargens:             : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_vargens</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;batteries:           : {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">get_num_bats</span><span class="p">()))</span></div>

<div class="viewcode-block" id="MPNetwork.show_properties"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.show_properties">[docs]</a>    <span class="k">def</span> <span class="nf">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">show_properties</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.update_properties"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.update_properties">[docs]</a>    <span class="k">def</span> <span class="nf">update_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span>
            <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_properties</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">nx</span><span class="p">:</span><span class="n">i</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">+</span> <span class="n">nx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_properties</span><span class="p">()</span></div>

<div class="viewcode-block" id="MPNetwork.update_set_points"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.update_set_points">[docs]</a>    <span class="k">def</span> <span class="nf">update_set_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">:</span>
            <span class="n">network</span><span class="o">.</span><span class="n">update_set_points</span><span class="p">()</span></div>

    <span class="c1"># Methods specific to MPPFNET</span>
<div class="viewcode-block" id="MPNetwork.get_network"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_network">[docs]</a>    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the pfnet network for a given time</span>

<span class="sd">        :param time: the time to get the network for (default: 0)</span>
<span class="sd">        :return: a pfnet network object</span>
<span class="sd">        :rtype: :class:`pfnet.Network`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">time</span><span class="p">]</span></div>

<div class="viewcode-block" id="MPNetwork.generate_load_profiles"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.generate_load_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_load_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generates load profiles using alpg</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">num_loads</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_profile_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_profile</span><span class="o">.</span><span class="n">LoadProfile</span><span class="p">()</span><span class="o">.</span><span class="n">get_load_profile</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                <span class="n">load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_load</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">load</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_profile_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">base_power</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>  <span class="c1"># convert to p.u.</span></div>

<div class="viewcode-block" id="MPNetwork.generate_solar_profiles"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.generate_solar_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_solar_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates solar profiles using PVWatts</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">num_vargens</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solar_profile_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar_profile</span><span class="o">.</span><span class="n">SolarProfile</span><span class="p">()</span><span class="o">.</span><span class="n">get_generation_profile</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vargen</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">generator</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_profile_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">base_power</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>  <span class="c1"># convert to p.u.</span></div>

<div class="viewcode-block" id="MPNetwork.set_prices"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.set_prices">[docs]</a>    <span class="k">def</span> <span class="nf">set_prices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">price_vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the price attribute of the buses to the values given</span>

<span class="sd">        :param price_vector: A vector of prices that has at least as many entries as there are time steps</span>
<span class="sd">        in the network. Prices in EUR/Base Power</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">buses</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">():</span>
                    <span class="n">bus</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price_vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="MPNetwork.get_adjacency_matrix"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_adjacency_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_adjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype: :class:`scipy.sparse.coo_matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">get_num_buses</span><span class="p">()</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">branches</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">bus_from</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">bus_to</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># symmetry</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">bus_to</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">bus_from</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nb</span><span class="p">))</span></div>



<div class="viewcode-block" id="MPNetwork.load_load_profile_from_csv"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.load_load_profile_from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">load_load_profile_from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        loads a load profile `from a csv file and updates the network accordingly.</span>
<span class="sd">        This also takes care of the conversion according to the base power.</span>

<span class="sd">        :param filename: the path to the CSV file</span>
<span class="sd">        :type filename: :class:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                        <span class="n">load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_load</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                        <span class="n">load</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">networks</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">base_power</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>  <span class="c1"># convert to p.u.</span></div>

<div class="viewcode-block" id="MPNetwork.get_projection_matrix"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_projection_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_projection_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the projection matrices for a list of buses</span>

<span class="sd">        :param buses:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_mats</span><span class="p">,</span> <span class="n">p_ang</span><span class="p">,</span> <span class="n">p_x</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">num_vars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_ang</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_local_only_vars</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># other buses</span>
        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">buses</span><span class="p">):</span>
            <span class="n">num_vars</span><span class="p">,</span> <span class="n">num_ang</span><span class="p">,</span> <span class="n">num_local_only_vars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">rows_p</span><span class="p">,</span> <span class="n">cols_p</span><span class="p">,</span> <span class="n">data_p</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">rows_ang</span><span class="p">,</span> <span class="n">cols_ang</span><span class="p">,</span> <span class="n">data_ang</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">rows_x</span><span class="p">,</span> <span class="n">cols_x</span><span class="p">,</span> <span class="n">data_x</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">bat</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">bats</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bat</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BAT_VAR_E</span><span class="p">):</span>
                    <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">]</span>
                    <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bat</span><span class="o">.</span><span class="n">index_E</span><span class="p">]</span>
                    <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">]</span>
                    <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bat</span><span class="o">.</span><span class="n">index_E</span><span class="p">]</span>
                    <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">num_local_only_vars</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">bat</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BAT_VAR_P</span><span class="p">):</span>
                    <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_vars</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bat</span><span class="o">.</span><span class="n">index_Pc</span><span class="p">,</span> <span class="n">bat</span><span class="o">.</span><span class="n">index_Pd</span><span class="p">]</span>
                    <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_vars</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bat</span><span class="o">.</span><span class="n">index_Pc</span><span class="p">,</span> <span class="n">bat</span><span class="o">.</span><span class="n">index_Pd</span><span class="p">]</span>
                    <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">num_local_only_vars</span> <span class="o">+=</span> <span class="mi">2</span>

            <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">gen</span><span class="p">:</span> <span class="n">gen</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">GEN_VAR_P</span><span class="p">),</span> <span class="n">bus</span><span class="o">.</span><span class="n">gens</span><span class="p">):</span>
                <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">gen</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">gen</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_local_only_vars</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># for gen in filter(lambda gen: gen.has_flags(pfnet.FLAG_VARS, pfnet.GEN_VAR_Q), bus.gens):</span>
            <span class="c1">#     rows_p += [num_vars, ]</span>
            <span class="c1">#     cols_p += [gen.index_Q, ]</span>
            <span class="c1">#     data_p += [1, ]</span>
            <span class="c1">#     num_vars += 1</span>
            <span class="c1">#     num_local_only_vars += 1</span>

            <span class="k">for</span> <span class="n">vargen</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vargen</span><span class="p">:</span> <span class="n">vargen</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">VARGEN_VAR_P</span><span class="p">),</span> <span class="n">bus</span><span class="o">.</span><span class="n">vargens</span><span class="p">):</span>
                <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">vargen</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">vargen</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_local_only_vars</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">load</span><span class="p">:</span> <span class="n">load</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">LOAD_VAR_P</span><span class="p">),</span> <span class="n">bus</span><span class="o">.</span><span class="n">loads</span><span class="p">):</span>
                <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">load</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">load</span><span class="o">.</span><span class="n">index_P</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_local_only_vars</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># for vargen in  filter(lambda gen: gen.has_flags(pfnet.FLAG_VARS, pfnet.VARGEN_VAR_Q), bus.vargens):</span>
            <span class="c1">#     rows_p += [num_vars, ]</span>
            <span class="c1">#     cols_p += [vargen.index_Q, ]</span>
            <span class="c1">#     data_p += [1, ]</span>
            <span class="c1">#     num_vars += 1</span>
            <span class="c1">#     num_local_only_vars += 1</span>
            <span class="k">if</span> <span class="n">bus</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BUS_VAR_VANG</span><span class="p">):</span>
                <span class="n">rows_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">]</span>
                <span class="n">cols_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index_v_ang</span><span class="p">]</span>
                <span class="n">data_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">adj_buses</span> <span class="o">=</span> <span class="p">[</span><span class="n">br</span><span class="o">.</span><span class="n">bus_from</span> <span class="k">for</span> <span class="n">br</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">branches_to</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">br</span><span class="o">.</span><span class="n">bus_to</span> <span class="k">for</span> <span class="n">br</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">branches_from</span><span class="p">]</span>  <span class="o">+</span> <span class="p">[</span><span class="n">bus</span><span class="p">]</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="n">bus</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BUS_VAR_VANG</span><span class="p">),</span> <span class="n">adj_buses</span><span class="p">)</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="n">adj_buses</span><span class="p">))</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_buses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">adj_bus</span> <span class="ow">in</span> <span class="n">adj_buses</span><span class="p">:</span>
                <span class="n">rows_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="n">adj_bus</span><span class="o">.</span><span class="n">index_v_ang</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_p</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>

                <span class="n">rows_ang</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_ang</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">cols_ang</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">data_ang</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">num_ang</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">p_ang</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data_ang</span><span class="p">,</span> <span class="p">(</span><span class="n">rows_ang</span><span class="p">,</span> <span class="n">cols_ang</span><span class="p">)),</span>
                                                       <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_local_only_vars</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">))</span>
            <span class="n">p_mats</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data_p</span><span class="p">,</span> <span class="p">(</span><span class="n">rows_p</span><span class="p">,</span> <span class="n">cols_p</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">num_vars</span><span class="p">))</span>
            <span class="n">p_x</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data_x</span><span class="p">,</span> <span class="p">(</span><span class="n">rows_x</span><span class="p">,</span> <span class="n">cols_x</span><span class="p">)),</span>
                                                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">num_vars</span><span class="p">))</span>

        <span class="c1"># check matrices</span>
        <span class="n">n_var</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#for bus in filter(lambda bus: (not bus.is_slack()), self.get_network().buses):</span>
        <span class="c1">#    index = bus.index</span>
        <span class="c1">#    num_gens = len(list(filter(lambda gen: gen.has_flags(pfnet.FLAG_VARS, pfnet.GEN_VAR_P), bus.gens)))</span>
        <span class="c1">#    num_vargens = len(list(filter(lambda vargen: vargen.has_flags(pfnet.FLAG_VARS, pfnet.VARGEN_VAR_P), bus.vargens)))</span>
        <span class="c1">#    local_variables = num_vargens + len(bus.bats) * 3 + num_gens</span>
        <span class="c1">#    angles = 1 + bus.degree</span>
        <span class="c1">#    n_var += 1 + local_variables</span>
            <span class="c1">#assert (p_mats[index].shape == (local_variables + angles, self.get_network().num_vars))</span>
            <span class="c1">#assert (p_ang[index].shape == (angles, local_variables + angles))</span>
        <span class="n">sim_p_mats</span><span class="p">,</span> <span class="n">sim_p_ang</span><span class="p">,</span> <span class="n">sim_p_x</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">buses</span><span class="p">):</span>
            <span class="n">sim_p_mats</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="n">p_mats</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)])</span>
            <span class="c1">#sim_p_ang[bus.index] = scipy.sparse.block_diag([p_ang[bus.index] for i in range(self.timesteps)])</span>
            <span class="c1">#sim_p_x[bus.index] = scipy.sparse.block_diag([p_x[bus.index] for i in range(self.timesteps)])</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">sim_p_mats</span><span class="p">,</span> <span class="n">sim_p_ang</span><span class="p">,</span> <span class="n">sim_p_x</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPNetwork.get_power_balance_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_power_balance_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_power_balance_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_pbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># projection matrix to select the power balance from A</span>
        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">buses</span><span class="p">):</span>
            <span class="n">p_pb</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(([</span><span class="mi">1</span><span class="p">],</span> <span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">])),</span>
                                                          <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_buses</span><span class="p">()))</span>
            <span class="c1"># stack matrix</span>
            <span class="n">p_pbs</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="n">p_pb</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">p_pbs</span></div>

<div class="viewcode-block" id="MPNetwork.get_coupling_ang_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_coupling_ang_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_coupling_ang_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_zs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">buses</span><span class="p">):</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">adj_buses</span> <span class="o">+=</span> <span class="p">[</span><span class="n">br</span><span class="o">.</span><span class="n">bus_from</span> <span class="k">for</span> <span class="n">br</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">branches_to</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">br</span><span class="o">.</span><span class="n">bus_to</span> <span class="k">for</span> <span class="n">br</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">branches_from</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">bus</span><span class="p">]</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bus</span><span class="p">:</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">is_slack</span><span class="p">()),</span> <span class="n">adj_buses</span><span class="p">))</span>
            <span class="n">adj_buses</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_buses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">adj_bus</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adj_buses</span><span class="p">):</span>
                <span class="n">cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">adj_bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p_z</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adj_buses</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">num_buses</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">p_zs</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="n">p_z</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">p_zs</span></div>

<div class="viewcode-block" id="MPNetwork.get_branch_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_branch_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_branch_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype: :class:`scipy.sparse.coo_matrix`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_bs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">buses</span><span class="p">:</span>
            <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">branch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">branches</span><span class="p">):</span>
                <span class="n">cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">branch</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p_b</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">branches</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_branches_not_on_outage</span><span class="p">()))</span>

            <span class="n">p_bs</span><span class="p">[</span><span class="n">bus</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="n">p_b</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_bs</span></div>

<div class="viewcode-block" id="MPNetwork.get_battery_var_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_battery_var_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_battery_var_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a projection matrix that extracts the variables (for all t) for all batteries</span>
<span class="sd">        connected to the given bus from the state vector x</span>

<span class="sd">        :param bus: the bus the matrix should be created for</span>
<span class="sd">        :return: a n x |x| sparse matrix where n is the number of variables of all</span>
<span class="sd">        batteries ( and all t) and |x| is the size of the (multi-period) state vector</span>
<span class="sd">        :rtype: :class:`scipy.sparse.coo_matrix`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># project all battery variables for the given bus</span>
        <span class="n">p_bat</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_battery_projection</span><span class="p">(</span><span class="n">battery</span><span class="p">)</span> <span class="k">for</span> <span class="n">battery</span> <span class="ow">in</span> <span class="n">bus</span><span class="o">.</span><span class="n">bats</span><span class="p">])</span>

        <span class="c1"># create blockdiagonal matrix with multiple timesteps</span>
        <span class="n">p_bat_mp</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="n">p_bat</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_bat_mp</span></div>

<div class="viewcode-block" id="MPNetwork.get_battery_projection"><a class="viewcode-back" href="../../mppfnet.html#mppfnet.mp_network.MPNetwork.get_battery_projection">[docs]</a>    <span class="k">def</span> <span class="nf">get_battery_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">battery</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a projection matrix that extracts all battery quantities that are defined as variables (:math:`E, P_c, P_d`)</span>
<span class="sd">        from the state vector of a single problem</span>

<span class="sd">        :param battery: the battery to create the projection matrix for``</span>
<span class="sd">        :type battery: :class:`pfnet.Battery`</span>
<span class="sd">        :return: a :math:`n \\times |x|` sparse matrix where :math:`n` is the number of variables of the battery`</span>
<span class="sd">        :rtype: :class:`scipy.sparse.coo_matrix`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">num_vars</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># project power charge and discharge if defined as a variable</span>
        <span class="k">if</span> <span class="n">battery</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BAT_VAR_P</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_vars</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">battery</span><span class="o">.</span><span class="n">index_Pc</span><span class="p">,</span> <span class="n">battery</span><span class="o">.</span><span class="n">index_Pd</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="c1"># project energy if defined as a variable</span>
        <span class="k">if</span> <span class="n">battery</span><span class="o">.</span><span class="n">has_flags</span><span class="p">(</span><span class="n">pfnet</span><span class="o">.</span><span class="n">FLAG_VARS</span><span class="p">,</span> <span class="n">pfnet</span><span class="o">.</span><span class="n">BAT_VAR_E</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span><span class="n">num_vars</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">battery</span><span class="o">.</span><span class="n">index_E</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">num_vars</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># size of the state vector</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span><span class="o">.</span><span class="n">num_vars</span>

        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Martin Zellner.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>